---
import Socials from './Socials.astro';
import { statSync } from 'fs';
import { join } from 'path';

// Try to get CV file's last modified date
let cvLastUpdated = 'January 2026';
let cvFileName = 'CV_Utkin_Timofei_2026_Jan.pdf';

try {
    const cvPath = join(process.cwd(), 'public', 'cv.pdf');
    const stats = statSync(cvPath);
    const lastModified = new Date(stats.mtime);

    // Format for display: "January 2026"
    cvLastUpdated = lastModified.toLocaleDateString('en-US', {
        month: 'long',
        year: 'numeric'
    });

    // Format for filename: "CV_Utkin_Timofei_2026_Jan.pdf"
    const year = lastModified.getFullYear();
    const month = lastModified.toLocaleDateString('en-US', { month: 'short' });
    cvFileName = `CV_Utkin_Timofei_${year}_${month}.pdf`;
} catch (error) {
    // If CV file doesn't exist yet, use default date
    console.warn('CV file not found, using default date');
}
---

<div>

    <!-- Start: Terminal -->
    <div class="mt-6 bg-black rounded-lg p-4 border border-gray-600 text-xs">

        <div class="flex items-center mb-2">
            <span class="text-primary mr-2">$</span>
            <span class="text-gray-100">astro dev</span>
        </div>

        <div class="mt-2 text-gray-400">
            Generated 1ms
            <br />
            Syncing content
            <br />
            Synced content
            <br />
            Listening on http://localhost:4321
            <br />
            watching for file changes...
        </div>

    </div>
    <!-- End: Terminal -->

    <!-- Start: CV Download Button -->
    <a
        href="/cv.pdf"
        download={cvFileName}
        title="Download CV/Resume"
        target="_blank"
        rel="noopener noreferrer"
        class="mt-6 flex items-center w-full px-4 py-3 rounded-lg bg-black text-gray-100 transition-all duration-150 border-2 border-primary hover:bg-primary hover:text-black font-medium group relative">

        <!-- Download Icon -->
        <svg
            class="w-5 h-5 transition-transform group-hover:translate-y-0.5 flex-shrink-0"
            fill="none"
            stroke="currentColor"
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" x2="12" y1="15" y2="3"></line>
        </svg>

        <span class="flex flex-col items-center flex-grow">
            <span class="text-sm">Download CV</span>
            <span class="text-xs text-gray-400 group-hover:text-black/70">Last updated {cvLastUpdated}</span>
        </span>
    </a>
    <!-- End: CV Download Button -->

    <!-- Start: Social Links -->
    <Socials />
    <!-- End: Social Links -->

</div>
