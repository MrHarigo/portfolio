---
import Socials from './Socials.astro';

// Import CV metadata generated at build time
// This avoids file system access during SSR
let cvMetadata;
try {
    cvMetadata = await import('../data/cv-metadata.json');
} catch (error) {
    // Fallback if metadata doesn't exist (shouldn't happen after build)
    const now = new Date();
    cvMetadata = {
        default: {
            displayDate: now.toLocaleDateString('en-US', { month: 'long', year: 'numeric' }),
            fileName: `CV_Utkin_Timofei_${now.getFullYear()}_${now.toLocaleDateString('en-US', { month: 'short' })}.pdf`
        }
    };
}

const { displayDate: cvLastUpdated, fileName: cvFileName } = cvMetadata.default;
---

<div>

    <!-- Start: Terminal -->
    <div class="mt-6 bg-black rounded-lg p-4 border border-gray-600 text-xs">

        <div class="flex items-center mb-2">
            <span class="text-primary mr-2">$</span>
            <span class="text-gray-100">astro dev</span>
        </div>

        <div class="mt-2 text-gray-400">
            Generated 1ms
            <br />
            Syncing content
            <br />
            Synced content
            <br />
            Listening on http://localhost:4321
            <br />
            watching for file changes...
        </div>

    </div>
    <!-- End: Terminal -->

    <!-- Start: CV Download Button -->
    <a
        href="/cv.pdf"
        download={cvFileName}
        title="Download CV/Resume"
        target="_blank"
        rel="noopener noreferrer"
        class="mt-6 flex items-center w-full px-4 py-3 rounded-lg bg-black text-gray-100 transition-all duration-150 border-2 border-primary hover:bg-primary hover:text-black font-medium group relative">

        <!-- Download Icon -->
        <svg
            class="w-5 h-5 transition-transform group-hover:translate-y-0.5 flex-shrink-0"
            fill="none"
            stroke="currentColor"
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" x2="12" y1="15" y2="3"></line>
        </svg>

        <span class="flex flex-col items-center flex-grow">
            <span class="text-sm">Download CV</span>
            <span class="text-xs text-gray-400 group-hover:text-black/70">Last updated {cvLastUpdated}</span>
        </span>
    </a>
    <!-- End: CV Download Button -->

    <!-- Start: Chat Button -->
    <button
        id="open-chat-button"
        class="mt-4 flex items-center w-full px-4 py-3 rounded-lg bg-black text-gray-100 transition-all duration-150 border-2 border-gray-600 hover:border-primary hover:text-primary font-medium group relative cursor-pointer">

        <!-- Chat Icon -->
        <svg
            class="w-5 h-5 transition-transform group-hover:scale-110 flex-shrink-0"
            fill="none"
            stroke="currentColor"
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg">
            <path d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
        </svg>

        <span class="flex flex-col items-center flex-grow">
            <span class="text-sm">Chat with my AI assistant</span>
            <span class="text-xs text-gray-400 group-hover:text-primary/70">Ask about my experience & skills</span>
        </span>
    </button>

    <script>
        document.getElementById('open-chat-button')?.addEventListener('click', () => {
            window.location.hash = 'chat';
            window.dispatchEvent(new CustomEvent('open-chat-modal'));
        });
    </script>
    <!-- End: Chat Button -->

    <!-- Start: Social Links -->
    <Socials />
    <!-- End: Social Links -->

</div>
